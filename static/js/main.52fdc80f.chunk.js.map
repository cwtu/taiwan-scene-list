{"version":3,"sources":["Scene.js","setups.js","App.js","index.js"],"names":["Scene","memo","Name","Description","DescriptionDetail","Picture","console","log","className","cities","getUrl","city","skip","url","reducer","state","action","type","isError","isLoading","window","scrollTo","scenes","newScenes","concat","statusText","Error","Navbar","setRequest","id","onClick","prevRequest","document","getElementById","value","defaultValue","onChange","select","disabled","map","initialState","Scenelist","request","useReducer","dispatch","useEffect","skipCount","fetchScenes","a","removeEventListener","scrollHandler","fetch","response","json","status","length","addEventListener","Math","round","innerHeight","scrollY","body","offsetHeight","scene","ID","App","useState","ReactDOM","render"],"mappings":"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","file":"static/js/main.52fdc80f.chunk.js","sourcesContent":["import { memo } from \"react\";\n\nconst Scene = memo(({ Name, Description, DescriptionDetail, Picture }) => {\n  console.log(\"load scene\");\n  if (!Description) Description = DescriptionDetail;\n\n  return (\n    <li className=\"scene\">\n      <h2>{Name}</h2>\n      <hr />\n      <p className=\"description\">{Description}</p>\n    </li>\n  );\n});\n\nexport default Scene;\n","export const loadSceneNum = 30; // max = 5185\n\nexport const cities = [\n  [\"臺北市\", \"Taipei\"],\n  [\"新北市\", \"NewTaipei\"],\n  [\"桃園市\", \"Taoyuan\"],\n  [\"臺中市\", \"Taichung\"],\n  [\"臺南市\", \"Tainan\"],\n  [\"高雄市\", \"Kaohsiung\"],\n  [\"基隆市\", \"Keelung\"],\n  [\"新竹市\", \"Hsinchu\"],\n  [\"新竹縣\", \"HsinchuCounty\"],\n  [\"苗栗縣\", \"MiaoliCounty\"],\n  [\"彰化縣\", \"ChanghuaCounty\"],\n  [\"南投縣\", \"NantouCounty\"],\n  [\"雲林縣\", \"YunlinCounty\"],\n  [\"嘉義縣\", \"ChiayiCounty\"],\n  [\"嘉義市\", \"Chiayi\"],\n  [\"屏東縣\", \"PingtungCounty\"],\n  [\"宜蘭縣\", \"YilanCounty\"],\n  [\"花蓮縣\", \"HualienCounty\"],\n  [\"臺東縣\", \"TaitungCounty\"],\n  [\"金門縣\", \"KinmenCounty\"],\n  [\"澎湖縣\", \"PenghuCounty\"],\n  [\"連江縣\", \"LienchiangCounty\"],\n];\n\nexport function getUrl(city = null, skip = 0) {\n  var url = \"https://ptx.transportdata.tw/MOTC/v2/Tourism/ScenicSpot\";\n\n  url =\n    url +\n    (city ? \"/\" + city + \"?\" : \"?\") +\n    \"$top=\" +\n    loadSceneNum +\n    \"&$skip=\" +\n    skip +\n    \"&$format=JSON\";\n\n  return url;\n}\nexport const reducer = (state, action) => {\n  switch (action.type) {\n    case \"PREP_FETCH\": {\n      return { ...state, isError: false, isLoading: true };\n    }\n    case \"INI_FETCH\": {\n      window.scrollTo(0, 0);\n      console.log(\"INI_FETCH\");\n      return {\n        ...state,\n        scenes: action.newScenes,\n        isLoading: false,\n      };\n    }\n    case \"CON_FETCH\": {\n      console.log(\"CON_FETCH\");\n      return {\n        ...state,\n        scenes: state.scenes.concat(action.newScenes),\n        isLoading: false,\n      };\n    }\n    case \"ERR_FETCH\": {\n      console.log(\"ERR_FETCH\");\n      return { ...state, isLoading: false, isError: action.statusText };\n    }\n    default: {\n      throw new Error(\"Unhandled action type\");\n    }\n  }\n};\n","import { useState, useEffect, useReducer } from \"react\";\nimport Scene from \"./Scene.js\";\nimport { loadSceneNum, cities, getUrl, reducer } from \"./setups.js\";\n\nconst App = () => {\n  const [request, setRequest] = useState(\"\");\n\n  return (\n    <>\n      <Navbar setRequest={setRequest} />\n      <Scenelist request={request} />\n    </>\n  );\n};\n\nconst Navbar = ({ setRequest }) => {\n  console.log(\"Navbar\");\n  return (\n    <div id=\"navbar\">\n      <h1 id=\"title\">臺灣景點瀏覽</h1>\n      <section id=\"form\">\n        <button\n          onClick={() => {\n            setRequest((prevRequest) => \"\");\n            document.getElementById(\"cities\").value = \"選擇城市\";\n          }}\n        >\n          全部\n        </button>\n        <select\n          id=\"cities\"\n          defaultValue=\"選擇城市\"\n          onChange={() => {\n            const select = document.getElementById(\"cities\");\n            setRequest((prevRequest) => select.value);\n          }}\n        >\n          <option key=\"default\" disabled>\n            選擇城市\n          </option>\n          {cities.map((city) => (\n            <option\n              key={city[1]}\n              value={city[1]}\n              onClick={() => setRequest((prevRequest) => city[1])}\n            >\n              {city[0]}\n            </option>\n          ))}\n        </select>\n      </section>\n    </div>\n  );\n};\n\nconst initialState = {\n  scenes: [],\n  isLoading: false,\n  isError: false,\n};\n\nconst Scenelist = ({ request }) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  console.log(\"Scenelist\");\n  // console.log(scenes);\n\n  useEffect(() => {\n    var skipCount = 0;\n    const fetchScenes = async (request) => {\n      dispatch({ type: \"PREP_FETCH\" });\n      window.removeEventListener(\"scroll\", scrollHandler); // prevent repeated fetch request\n\n      console.log(request, skipCount);\n      const response = await fetch(getUrl(request, skipCount));\n      const newScenes = await response.json();\n\n      if (response.status < 400) {\n        skipCount\n          ? dispatch({ type: \"CON_FETCH\", newScenes: newScenes })\n          : dispatch({ type: \"INI_FETCH\", newScenes: newScenes });\n\n        if (newScenes.length === loadSceneNum)\n          window.addEventListener(\"scroll\", scrollHandler); // add listener back only when there are more to fetch\n\n        skipCount += loadSceneNum;\n      } else {\n        dispatch({ type: \"ERR_FETCH\", statusText: response.statusText });\n      }\n    };\n\n    const scrollHandler = () => {\n      if (\n        Math.round(window.innerHeight + window.scrollY) >=\n        document.body.offsetHeight\n      ) {\n        fetchScenes(request);\n      }\n    };\n\n    fetchScenes(request);\n    window.addEventListener(\"scroll\", scrollHandler);\n    return () => {\n      console.log(\"cleanup\");\n      window.removeEventListener(\"scroll\", scrollHandler);\n    };\n  }, [request]);\n\n  return (\n    <>\n      {state.isError ? (\n        <p id=\"error\">Error: {state.isError}</p>\n      ) : (\n        <ul className=\"scenelist\">\n          {state.scenes.map((scene) => (\n            <Scene key={scene.ID} {...scene} />\n          ))}\n          {state.isLoading && <div id=\"loading\">Loading...</div>}\n        </ul>\n      )}\n    </>\n  );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport \"./index.css\";\nimport App from \"./App.js\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}